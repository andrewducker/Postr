		<div id="ljCredentials" title="Livejournal Details">
			<form>
				<label for=ljUsername>User Name:</label> <input type="text" id="ljUsername" name="username"><BR>
				<label for=ljPassword>Password:</label> <input type="password" id="ljPassword" name="password"><BR>
				<button type="button" id="ljCredentialsVerify">Verify</button><BR>
				<div id="ljIdentity"></div><BR>
				<label for=ljTimeZone>Time Zone:</label><input type=text id="ljTimeZone">
			</form>
		</div>
		
		<script type="text/javascript">
			var Livejournal = function Livejournal(){
				var sitename = "Livejournal";
				var siteID = "livejournal";
				var usernameID = "#ljUsername";
				var passwordID = "#ljPassword";
				var timezoneID = "#ljTimeZone";
				var credentialsWizard = "#ljCredentials"
				var identityID = "#ljIdentity"; 
				var verifyID = "#ljCredentialsVerify";
				
				var that = this;
				
				var saveCredentials = function(){
					if($(identityID).text() != ""){
						var params = {method:"SaveData", username:$(usernameID).val(), password:$(passwordID).val(), timezone:$(timezoneID).val()};
						var posting = $.post(siteID,{params:JSON.stringify(params)});
						wizards.registerCallForWizardDisplay(posting).done(function(data){
							data.siteName = sitename;
							data.username = params.username;
							data.timezone = params.timezone;
							that.currentDeferral.resolve(data);
						});
					}
					else{
						wizards.showError("Identity not validated");
					}
				}
			
				var updateCredentials = function(){
					if($(identityID).text() != ""){
						var params = {method:"UpdateData", password:$(passwordID).val(), timezone:$(timezoneID).val(), key:that.currentOutput};
						var posting = $.post(siteID,{params:JSON.stringify(params)});
						wizards.registerCallForWizardDisplay(posting).done(function(data){
							data.timezone = params.timezone;
							that.currentDeferral.resolve(data);
						});
					}
					else{
						wizards.showError("Identity not validated");
					}
				}
				
				var addOutput = function(){
					$(identityID).text("");
					$(timezoneID).val("");
					$(passwordID).val("");
					$(usernameID).val("");
					$(usernameID).removeProp('disabled');
					var buttons = $(credentialsWizard ).dialog( "option", "buttons", [{text:"ok", click: function(){saveCredentials()}}]);
					that.currentDeferral = $.Deferred();
					wizards.showPage(credentialsWizard);
					return that.currentDeferral;
				}
			
				var updateOutput = function(existingData){
					$(identityID).text("");
					$(passwordID).val("");
					$(usernameID).val(existingData.userName);
					$(timezoneID).val(existingData.timezone);
					$(usernameID).prop('disabled','disabled');
					var buttons = $( credentialsWizard ).dialog( "option", "buttons", [{text:"ok", click: function(){updateCredentials()}}]);
					that.currentOutput = existingData.key;
					that.currentDeferral = $.Deferred();
					wizards.showPage(credentialsWizard);
					return that.currentDeferral;
				}
				
				$(verifyID).click(function(){
					var params = {method:"VerifyPassword", username:$(usernameID).val(), password:$(passwordID).val()};
					var posting = $.post(siteID,{params:JSON.stringify(params)});
					posting.done(function(data){
						var parsedData = $.parseJSON(data);
						$(identityID).text(parsedData.result);
						wizards.setProperty(credentialsWizard,"height","auto");
					});
					wizards.registerCallForWizardOnError(posting);
				});
				
				AddOutput(sitename, addOutput,updateOutput);
			};
		
			$(function() {
				wizards.register("#ljCredentials");
				var livejournal = new Livejournal();
			});
		</script>
