 <div id="ljCredentials" title="Livejournal Details">
	<form>
		<label for=ljUsername>User Name:</label> <input type="text" id="ljUsername" name="username"><BR>
		<label for=ljPassword>Password:</label> <input type="password" id="ljPassword" name="password"><BR>
		<button type="button" id="ljCredentialsVerify">Verify</button><BR>
		<div id="ljIdentity"></div><BR>
		<label for=ljTimeZone>Time Zone:</label><input type=text id="ljTimeZone">
	</form>
 </div>

<div id="ljResults" title="Livejournal Details Updated">
	 <div id="ljResultsText"><h2>Did it work?</h2></div>
</div>

<script type="text/javascript">

livejournal = new Object();

livejournal.sitename="Livejournal";

livejournal.saveCredentials = function(){
	if($("#ljIdentity").text() != ""){
		var params = {method:"SaveData", username:$("#ljUsername").val(), password:$("#ljPassword").val(), timezone:$("#ljTimeZone").val()};
		var posting = $.post("livejournal",{params:JSON.stringify(params)});
		wizards.registerCallForWizardDisplay(posting,"ljResultsText","ljResults").done(function(data){
			data.siteName=livejournal.sitename;
			data.username = params.username;
			livejournal.currentDeferral.resolve(data);
		});
	}
	else{
		wizards.showError("Identity not validated");
	}
}

wizards.register("#ljCredentials",{buttons: [{text:"ok", click: livejournal.saveCredentials}]});
wizards.register("#ljResults",{buttons: [{text:"Done", click: wizards.closeAllPages}]});

livejournal.AddOutput = function(){
	$("#ljIdentity").text("");
	$("#ljTimeZone").val("");
	livejournal.currentDeferral = $.Deferred();
	wizards.showPage("ljCredentials");
	return livejournal.currentDeferral;
}

livejournal.removeOutput = function(key){
	var params = {method:"RemoveData", key:parseInt(key)};
	livejournal.currentDeferral = $.post("livejournal",{params:JSON.stringify(params)});
	wizards.registerCallForWizardDisplay(livejournal.currentDeferral,"ljResultsText","ljResults");
	return livejournal.currentDeferral;
}

$(function() {
	$("#ljCredentialsVerify").click(function(){
		var params = {method:"VerifyPassword", username:$("#ljUsername").val(), password:$("#ljPassword").val()};
		var posting = $.post("livejournal",{params:JSON.stringify(params)});
		posting.done(function(data){
			var parsedData = $.parseJSON(data);
			$("#ljIdentity").text(parsedData.result);
			wizards.setProperty("ljCredentials","height","auto");
		});
		wizards.registerCallForWizardOnError(posting);
	});
	AddOutput(livejournal.sitename, livejournal.AddOutput,null,livejournal.removeOutput);
});
</script>
