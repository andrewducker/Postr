		<div id="ljCredentials" title="Livejournal Details">
			<form>
				<label for=ljUsername>User Name:</label> <input type="text" id="ljUsername" name="username"><BR>
				<label for=ljPassword>Password:</label> <input type="password" id="ljPassword" name="password"><BR>
				<button type="button" id="ljCredentialsVerify">Verify</button><BR>
				<div id="ljIdentity"></div><BR>
				<label for=ljTimeZone>Time Zone:</label><input type=text id="ljTimeZone">
			</form>
		</div>
		<div id="ljPostMaker" title="Livejournal Posting">
			<form>
				<label for=ljSubjectLine>Subject Line:</label> <input type="text" id="ljSubjectLine" name="subjectLine"><BR>
				<label for=ljText>Text:</label> <textarea rows = 5 id="ljText" name="text"></textarea><BR>
				<label for=ljTags>Tags:</label> <input type="text" id="ljTags" name="text"><BR>
			</form>
		</div>		
		
		
		<script type="text/javascript">
			var Livejournal = function Livejournal(){
				var siteName = "Livejournal";
				var siteID = "livejournal";
				var usernameID = "#ljUsername";
				var passwordID = "#ljPassword";
				var timezoneID = "#ljTimeZone";
				var credentialsWizard = "#ljCredentials"
				var identityID = "#ljIdentity"; 
				var verifyID = "#ljCredentialsVerify";
				var postingWizard = "#ljPostMaker";
				var subjectID = "#ljSubjectLine";
				var textID = "#ljText";
				var tagsID = "#ljTags";

				
				var that = this;
				
				var saveCredentials = function(){
					if($(identityID).text() != ""){
						var params = {method:"SaveData", userName:$(usernameID).val(), password:$(passwordID).val(), timeZone:$(timezoneID).val()};
						var posting = $.post(siteID,{params:JSON.stringify(params)});
						wizards.registerCallForWizardDisplay(posting).done(function(data){
							data.siteName = siteName;
							data.userName = params.userName;
							data.timeZone = params.timeZone;
							that.currentDeferral.resolve(data);
						});
					}
					else{
						wizards.showError("Identity not validated");
					}
				}
			
				var updateCredentials = function(){
					if($(identityID).text() != ""){
						var params = {method:"UpdateData", password:$(passwordID).val(), timeZone:$(timezoneID).val(), key:that.currentOutput.key};
						var posting = $.post(siteID,{params:JSON.stringify(params)});
						wizards.registerCallForWizardDisplay(posting).done(function(data){
							that.currentOutput.timeZone = params.timeZone;
							that.currentDeferral.resolve();
						});
					}
					else{
						wizards.showError("Identity not validated");
					}
				}
				
				var makePost = function(){
					var params = {method:"MakePost", contents:$(textID).val(), subject:$(subjectID).val(),tags:$(tagsID).val(), output:that.currentOutput.key};
					var posting = $.post(siteID,{params:JSON.stringify(params)});
					wizards.registerCallForWizardDisplay(posting).done(function(data){
						that.currentDeferral.resolve();
					});

				}
				
				var addPosting = function(existingData){
					$(subjectID).val("");
					$(textID).val("");
					$(tagsID).val("");
					var buttons = $(postingWizard).dialog( "option", "buttons", [{text:"ok", click: function(){makePost()}}]);
					that.currentDeferral = $.Deferred();
					that.currentOutput = existingData;
					wizards.showPage(postingWizard);
					return that.currentDeferral;
				}
				
				var addOutput = function(){
					$(identityID).text("");
					$(timezoneID).val("");
					$(passwordID).val("");
					$(usernameID).val("");
					$(usernameID).removeProp('disabled');
					var buttons = $(credentialsWizard ).dialog( "option", "buttons", [{text:"ok", click: function(){saveCredentials()}}]);
					that.currentDeferral = $.Deferred();
					wizards.showPage(credentialsWizard);
					return that.currentDeferral;
				}
			
				var updateOutput = function(existingData){
					$(identityID).text("");
					$(passwordID).val("");
					$(usernameID).val(existingData.userName);
					$(timezoneID).val(existingData.timeZone);
					$(usernameID).prop('disabled','disabled');
					var buttons = $( credentialsWizard ).dialog( "option", "buttons", [{text:"ok", click: function(){updateCredentials()}}]);
					that.currentOutput = existingData;
					that.currentDeferral = $.Deferred();
					wizards.showPage(credentialsWizard);
					return that.currentDeferral;
				}
				
				$(usernameID).change(function(){
					$(identityID).text("");
				})

				$(passwordID).change(function(){
					$(identityID).text("");
				})

				$(verifyID).click(function(){
					var params = {method:"VerifyPassword", userName:$(usernameID).val(), password:$(passwordID).val()};
					var posting = $.post(siteID,{params:JSON.stringify(params)});
					posting.done(function(data){
						var parsedData = $.parseJSON(data);
						$(identityID).text(parsedData.result);
						wizards.setProperty(credentialsWizard,"height","auto");
					});
					wizards.registerCallForWizardOnError(posting);
				});
				AddOutput(siteName, addOutput,updateOutput,addPosting);
			};
		
			$(function() {
				wizards.register("#ljCredentials");
				wizards.register("#ljPostMaker");
				var livejournal = new Livejournal();
			});
		</script>
