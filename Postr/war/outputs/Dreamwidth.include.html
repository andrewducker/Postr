 <div id="dwCredentials" title="Dreamwidth Details">
	<form>
		<label for=dwUsername>User Name:</label> <input type="text" id="dwUsername" name="username"><BR>
		<label for=dwPassword>Password:</label> <input type="password" id="dwPassword" name="password"><BR>
		<button type="button" id="dwCredentialsVerify">Verify</button><BR>
		<div id="dwIdentity"></div><BR>
		<label for=dwTimeZone>Time Zone:</label><input type=text id="dwTimeZone">
	</form>
 </div>

<div id="dwResults" title="Dreamwidth Details Updated">
	 <div id="dwResultsText"><h2>Did it work?</h2></div>
</div>

<script type="text/javascript">
function saveDreamwidthCredentials()
{
	if($("#dwIdentity").text() != ""){
		var params = {method:"SaveData", username:$("#dwUsername").val(), password:$("#dwPassword").val(), timezone:$("#dwTimeZone").val()};
		var posting = $.post("dreamwidth",{params:JSON.stringify(params)});
		wizards.registerCallForWizardDisplay(posting,"dwResultsText","dwResults");
	}
	else{
		wizards.showError("Identity not validated");
	}
}

wizards.register("#dwCredentials",{buttons: [{text:"ok", click: saveDreamwidthCredentials}]});
wizards.register("#dwResults",{buttons: [{text:"Done", click: function(){location.reload()}}]});

function AddDreamwidthOutput(){
	$("#dwIdentity").text("");
	$("#dwTimeZone").val("");
	wizards.showPage("dwCredentials");
}

function RemoveDreamwidthOutput(key){
	var params = {method:"RemoveData", key:parseInt(key)};
	var posting = $.post("dreamwidth",{params:JSON.stringify(params)});
	wizards.registerCallForWizardDisplay(posting,"dwResultsText","dwResults");
}

$(function() {
	$("#dwCredentialsVerify").click(function(){
		var params = {method:"VerifyPassword", username:$("#dwUsername").val(), password:$("#dwPassword").val()};
		var posting = $.post("dreamwidth",{params:JSON.stringify(params)});
		posting.done(function(data){
			var parsedData = $.parseJSON(data);
			$("#dwIdentity").text(parsedData.result);
			wizards.setProperty("dwCredentials","height","auto");
		});
		wizards.registerCallForWizardOnError(posting);
	});
	AddOutput("Dreamwidth", AddDreamwidthOutput,null,RemoveDreamwidthOutput);
});
</script>
